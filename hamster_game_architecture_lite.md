# 仓鼠剧情互动游戏 - 技术架构文档

> 版本：v0.1 (MVP)

---

## 1. 技术栈总览

| 层级 | 技术选型 | 说明 |
|------|----------|------|
| 客户端 | Electron | 基于 Chromium，视频播放稳定，Web技术栈开发 |
| 前端 | HTML/CSS/JS | MVP使用原生，后期可引入React |
| 后端 | Python + FastAPI | 轻量异步框架 |
| 数据库 | SQLite | MVP阶段足够，便于开发 |
| 视频托管 | 云存储（待定） | 支持Range请求，边下边播 |

---

## 2. 模块设计

### 2.1 客户端 (Electron)

| 模块 | 解决方案 |
|------|----------|
| 视频播放 | HTML5 `<video>` 标签，原生支持Range请求 |
| UI交互 | HTML/CSS/JS，视频上层叠加DOM元素 |
| 本地缓存 | Electron userData目录 + 文件系统API |
| HTTP通信 | fetch API，封装统一请求模块 |

### 2.2 后端 (Python FastAPI)

| 模块 | 解决方案 |
|------|----------|
| 认证 | device_id识别 + JWT token |
| 存档管理 | SQLite读写，JSON字段存储复杂数据 |
| 游戏逻辑 | 纯Python计算，状态变更/节点跳转 |
| 剧情配置 | JSON文件静态加载 |

### 2.3 数据存储

**数据库表结构**：暂未设计，待开发阶段确定。

初步规划表：
- `users` - 用户表
- `saves` - 存档表

### 2.4 剧情配置文件

存放位置：`/server/story_config/nodes.json`

节点类型：
- `story` - 剧情节点（视频+选项）
- `minigame` - 小游戏节点（问答题）

配置内容包括：节点ID、视频URL、选项列表、状态影响、跳转目标等。

---

## 3. MVP范围与未来改进

| 功能 | MVP设计 | 未来改进方向 |
|------|---------|-------------|
| 认证 | device_id自动登录 | 账号注册、第三方登录、多设备同步 |
| 存档 | 单存档槽 | 多存档槽、云存档 |
| 视频缓存 | 仅缓存当前会话 | LRU淘汰策略、预取后续节点 |
| 剧情配置 | 手写JSON | 可视化编辑器 |
| 小游戏 | 仅问答题 | 按键QTE、鼠标交互等 |
| URL安全 | 直接暴露URL | 临时签名URL |
| 数据库 | SQLite本地文件 | PostgreSQL、读写分离 |

---

## 4. 开发计划

| 阶段 | 任务 | 预估 |
|------|------|------|
| 1 | 环境搭建、项目初始化 | 1天 |
| 2 | 后端：认证 + 存档模块 | 3天 |
| 3 | 后端：剧情配置 + 游戏逻辑 | 3天 |
| 4 | 客户端：Electron框架 + 视频播放 | 4天 |
| 5 | 客户端：UI交互层 | 3天 |
| 6 | 道具系统 + 换装系统 | 2天 |
| 7 | 视频素材接入 + 联调测试 | 4天 |
| **合计** | | **约20天** |

---

## 附录：目录结构

```
hamster-game/
├── client/                 # Electron客户端
│   ├── src/
│   └── package.json
├── server/                 # Python后端
│   ├── app/
│   ├── story_config/      # 剧情JSON配置
│   └── requirements.txt
└── docs/
```
